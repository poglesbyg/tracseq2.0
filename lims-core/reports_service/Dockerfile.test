FROM rustlang/rust:nightly-slim as builder

WORKDIR /app

# Create simple test file
RUN echo 'fn main() { println!("Reports service test running..."); loop { std::thread::sleep(std::time::Duration::from_secs(5)); println!("Still running..."); } }' > main.rs

# Build
RUN rustc main.rs -o reports-service

# Runtime
FROM debian:bookworm-slim

RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY --from=builder /app/reports-service /app/reports-service

CMD ["./reports-service"] 